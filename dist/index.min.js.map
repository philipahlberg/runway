{"version":3,"file":"index.min.js","sources":["../src/path.js","../src/query.js","../src/utils.js","../src/route.js","../src/router.js"],"sourcesContent":["const MATCH_ALL = '[^/]*';\r\n\r\nconst CATCH_ALL = '([^/]+)';\r\n\r\nconst PARAMETER_PATTERN = /:([^\\/]+)/;\r\n\r\n// optional trailing slash\r\n// only matches the slash if nothing follows\r\nconst MATCH_TRAILING_SLASH = '(?:[\\/]?(?=$))?';\r\n\r\n// implements '**' as a wildcard\r\nconst WILDCARD_PATTERN = /\\*\\*/g;\r\n\r\nexport class Path {\r\n  /**\r\n   * \r\n   * @param {String} input The path to compile\r\n   * @param {Boolean} exact Whether or not the pattern should match anything after the path\r\n   */\r\n  constructor(path = '', exact = false) {\r\n    // replace any wildcards with\r\n    // their corresponding expression\r\n    path = path.replace(WILDCARD_PATTERN, MATCH_ALL);\r\n\r\n    let match;\r\n    let keys = [];\r\n    // convert :param to a catch-all group\r\n    // and save the keys\r\n    while ((match = PARAMETER_PATTERN.exec(path)) != null) {\r\n      path = path.replace(match[0], CATCH_ALL);\r\n      keys.push(match[1]);\r\n    }\r\n\r\n    if (!path.endsWith('/')) {\r\n      path += MATCH_TRAILING_SLASH;\r\n    }\r\n\r\n    path = exact ? `^${path}$` : `^${path}`;\r\n    const pattern = new RegExp(path, 'i');\r\n\r\n    this.pattern = pattern;\r\n    this.keys = keys;\r\n  }\r\n\r\n  /**\r\n   * Convenience function that mirrors RegExp.test\r\n   * @param {String} path\r\n   * @return {Boolean} \r\n   */\r\n  matches(path) {\r\n    return this.pattern.test(path);\r\n  }\r\n\r\n  /**\r\n   * Find the matched part of the given path.\r\n   * @param {String} path path to match against\r\n   * @return {String} matched portion of the path \r\n   */\r\n  matched(path) {\r\n    let matched = this.pattern.exec(path);\r\n    return matched && matched[0] || '';\r\n  }\r\n\r\n  /**\r\n   * Parse a path string for parameter values.\r\n   * @param {String} path the path to get values from\r\n   * @return {ParsedExpression}\r\n   */\r\n  parse(path) {\r\n    return new ParsedExpression(\r\n      path,\r\n      this.pattern,\r\n      this.keys\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Transfer matched parameters in the given url to\r\n   * the target path, filling in named parameters in if they exist.\r\n   * @param {String} current a matched url\r\n   * @param {String} target a path\r\n   * @return {String} The target path with parameters filled in\r\n   */\r\n  transfer(current, target) {\r\n    const values = this.pattern.exec(current).slice(1);\r\n    let transferred = target;\r\n\r\n    let i = values.length;\r\n    while (i--) {\r\n      transferred = transferred\r\n        .replace(':' + this.keys[i], values[i]);\r\n    }\r\n\r\n    return transferred;\r\n  }\r\n}\r\n\r\nclass ParsedExpression {\r\n  constructor(url, pattern, keys) {\r\n    this.url = url;\r\n    this.keys = keys;\r\n    this.values = pattern.exec(url).slice(1);\r\n  }\r\n\r\n  get(key) {\r\n    return this.values[this.keys.indexOf(key)];\r\n  }\r\n\r\n  set(key, value) {\r\n    return this.url.replace(this.get(key), value);\r\n  }\r\n\r\n  has(key) {\r\n    return this.get(key) !== undefined;\r\n  }\r\n\r\n  all() {\r\n    return this.keys.reduce((object, key, i) => {\r\n      object[key] = this.values[i];\r\n      return object;\r\n    }, {});\r\n  }\r\n\r\n  entries() {\r\n    let entries = [];\r\n    for (let i = 0; i < this.keys.length; i++) {\r\n      entries.push([this.keys[i], this.values[i]]);\r\n    }\r\n    return entries;\r\n  }\r\n\r\n  *[Symbol.iterator]() {\r\n    const length = this.keys.length;\r\n    for (let i = 0; i < length; i++) {\r\n      yield [this.keys[i], this.values[i]];\r\n    }\r\n  }\r\n}\r\n\r\nexport default Path;","export class Query extends Map {\r\n  static from(object) {\r\n    return new Query(Object.entries(object));\r\n  }\r\n\r\n  static of(...pairs) {\r\n    return new Query(pairs);\r\n  }\r\n\r\n  static parse(string) {\r\n    if (string.startsWith('?')) {\r\n      string = string.substring(1);\r\n    }\r\n\r\n    let entries = [];\r\n    if (string !== '') {\r\n      entries = string.split('&')\r\n        .map((substring) => substring.split('='));\r\n    }\r\n\r\n    return new Query(entries);\r\n  }\r\n\r\n  toString() {\r\n    let string = '';\r\n    for (const [key, value] of this) {\r\n      string += `&${key}=${value}`;\r\n    }\r\n    return string.substring(1);\r\n  }\r\n}","/**\r\n * Append a leading slash, and remove all excess slashes.\r\n * @param {string} path\r\n * @returns {string}\r\n */\r\nexport function normalize(path) {\r\n  return ('/' + path).replace(/[\\/]+/g, '/');\r\n}\r\n\r\n/**\r\n * Determines if the given object is a callable function.\r\n * An ES2015 class will return false, while ordinary functions,\r\n * arrow functions, generator functions and async functions return true.\r\n * @param {object} object the object that is to be inspected\r\n * @returns {boolean} if the given object is a callable function\r\n */\r\nexport function isFunction(object) {\r\n  if (!(typeof object === 'function')) {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Truthiness matrix for `hasOwnProperty` on functions:\r\n   * \r\n   *           | Class | Ordinary | Arrow | Async | Generator |\r\n   * ---------------------------------------------------------|\r\n   * arguments | false |   true   | false | false |   false   |\r\n   * prototype | true  |   true   | false | false |   true    |\r\n   * \r\n   */\r\n\r\n  const tag = object[Symbol.toStringTag];\r\n  if (tag === 'AsyncFunction' || tag === 'GeneratorFunction') {\r\n    return true;\r\n  } else {\r\n    // Ordinary functions have an `arguments` property, which classes do not.\r\n    const isNormalFunction = object.hasOwnProperty('arguments');\r\n    // Arrow functions do not have a `prototype` property, which classes do.\r\n    const isArrowFunction = !object.hasOwnProperty('prototype');\r\n    return isNormalFunction || isArrowFunction;\r\n  }\r\n}\r\n\r\nexport function isPromise(object) {\r\n  return object[Symbol.toStringTag] === 'Promise';\r\n}\r\n\r\nexport function clone(obj) {\r\n  return Object.assign({}, obj);\r\n}\r\n\r\nexport function freeze(obj) {\r\n  return Object.freeze(obj);\r\n}\r\n\r\nexport function always() {\r\n  return true;\r\n}\r\n\r\nexport const EMPTY = freeze(Object.create(null));\r\n\r\nconst components = new WeakMap();\r\n\r\n/**\r\n * Resolve an identifier to a constructor.\r\n * @param {Promise|Function|String} component the identifier\r\n * @param {Function} callback\r\n */\r\nexport function load(component, callback) {\r\n  if (typeof component === 'string') {\r\n    // If it's a string, assume that it has\r\n    // been defined, and return the constructor\r\n    // from the element registry\r\n    callback(customelements.get(component));\r\n\r\n  } else if (components.has(component)) {\r\n    // If it has been resolved before,\r\n    // return the resolved value\r\n    callback(components.get(component));\r\n\r\n  } else if (isFunction(component)) {\r\n    // If it's a function, call it.\r\n    let called = component();\r\n    if (isPromise(called)) {\r\n      // If the function returns a promise,\r\n      // assume it either resolves to the\r\n      // constructor directly, or to a module\r\n      // wherein the constructor is the default\r\n      // export\r\n      called.then((m) => {\r\n        let ctor = m.default || m;\r\n        components.set(component, ctor);\r\n        callback(ctor);\r\n      });\r\n    } else {\r\n      // If the function call returned something\r\n      // that isn't a promise, assume that it returned\r\n      // a constructor directly\r\n      components.set(component, called);\r\n      callback(called);\r\n    }\r\n  } else {\r\n    callback(component);\r\n  }\r\n}\r\n","import { Path } from './path.js';\r\nimport { Query } from './query.js';\r\nimport {\r\n  load,\r\n  normalize,\r\n  clone,\r\n  freeze,\r\n  always,\r\n  isFunction,\r\n  isPromise\r\n} from './utils.js';\r\n\r\nexport class Route extends Path {\r\n  constructor(options) {\r\n    super(options.path, options.exact);\r\n    this.path = options.path;\r\n    this.exact = options.exact === true;\r\n    this.redirect = options.redirect;\r\n    this.component = options.component;\r\n    this.slot = options.slot;\r\n    this.guard = options.guard || always;\r\n    this.meta = freeze(options.meta || {});\r\n    this.properties = freeze(options.properties || {});\r\n    this.children = (options.children || []).map(record =>\r\n      createChildRoute(clone(record), this)\r\n    );\r\n  }\r\n\r\n  async import() {\r\n    return new Promise(resolve => {\r\n      load(this.component, Component => resolve(Component));\r\n    });\r\n  }\r\n}\r\n\r\nfunction createChildRoute(record, parent) {\r\n  if (record.path === '') {\r\n    record.path = parent.path;\r\n  } else {\r\n    record.path = normalize(parent.path + '/' + record.path);\r\n  }\r\n\r\n  if (record.redirect != null) {\r\n    if (record.redirect === '') {\r\n      record.redirect = parent.path;\r\n    } else {\r\n      record.redirect = normalize(parent.path + '/' + record.redirect);\r\n    }\r\n  }\r\n\r\n  if (record.children == null) {\r\n    record.exact = true;\r\n  }\r\n\r\n  return new Route(record);\r\n}\r\n\r\nexport class ActivatedRoute {\r\n  constructor(route, url) {\r\n    this.parameters = route.parse(url);\r\n    this.matched = route.matched(url);\r\n    this.query = Query.parse(url);\r\n    this.hash = location.hash.substring(1);\r\n  }\r\n}\r\n","import { Route, ActivatedRoute } from './route.js';\r\nimport { EMPTY } from './utils.js';\r\n\r\nexport default class Router {\r\n  constructor(records, target) {\r\n    this.views = [];\r\n    this.matched = [];\r\n    this.routes = records.map(record => new Route(record));\r\n    this.onPopstate = this.onPopstate.bind(this);\r\n\r\n    window.Router = this;\r\n\r\n    if (target) {\r\n      this.connect(target);\r\n    }\r\n  }\r\n\r\n  connect(target) {\r\n    this.target = target;\r\n    window.addEventListener('popstate', this.onPopstate);\r\n    const path = decodeURIComponent(location.pathname);\r\n    const { matched, url } = this.match(path);\r\n    history.replaceState(null, null, url);\r\n    return this.render(matched);\r\n  }\r\n\r\n  disconnect() {\r\n    window.removeEventListener('popstate', this.onPopstate);\r\n    this.teardown();\r\n    this.matched = [];\r\n    this.target = null;\r\n  }\r\n\r\n  onPopstate() {\r\n    const path = decodeURIComponent(location.pathname);\r\n    const { matched } = this.match(path);\r\n    this.render(matched);\r\n  }\r\n\r\n  push(url, { data, title } = EMPTY) {\r\n    url = decodeURIComponent(url);\r\n    const { matched, path } = this.match(url);\r\n    history.pushState(data, title, path);\r\n    return this.render(matched);\r\n  }\r\n\r\n  replace(url, { data, title } = EMPTY) {\r\n    url = decodeURIComponent(url);\r\n    const { matched, path } = this.match(url);\r\n    history.replaceState(data, title, path);\r\n    return this.render(matched);\r\n  }\r\n\r\n  match(path) {\r\n    const search = (routes, matched) => {\r\n      // Find a starting match\r\n      const route = routes\r\n        .find(r => r.matches(path) || r.guard());\r\n\r\n      if (route) {\r\n        matched.push(route);\r\n        if (route.redirect != null) {\r\n          // transfer any matched parameters\r\n          const matched = route.matched(path);\r\n          const redirected = route.transfer(matched, route.redirect);\r\n          // and start over\r\n          return this.match(redirected);\r\n        } else if (route.children) {\r\n          // Search through the children\r\n          return search(route.children, matched);\r\n        } else {\r\n          return { matched, path };\r\n        }\r\n      } else {\r\n        // End the search here\r\n        return { matched, path };\r\n      }\r\n    }\r\n\r\n    return search(this.routes, []);\r\n  }\r\n\r\n  async render(matched) {\r\n    // Importing early in case both network\r\n    // and device is slow, but not awaiting\r\n    // it just yet.\r\n    const load = Promise.all(\r\n      matched.map(route => route.import())\r\n    );\r\n\r\n    // Find the index at which the matched routes\r\n    // differ from the active routes.\r\n    let start;\r\n    for (let i = 0; i < matched.length; i++) {\r\n      const match = matched[i];\r\n      if (this.matched.length < i + 1) {\r\n        start = i;\r\n        break;\r\n      } else {\r\n        const active = this.matched[i];\r\n        if (match !== active) {\r\n          start = i;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (start == null) {\r\n      start = matched.length;\r\n    }\r\n\r\n    this.matched = matched;\r\n\r\n    // Remove the obsolete elements\r\n    const removals = this.views.slice(start);\r\n    while (removals.length > 0) {\r\n      const element = removals.pop();\r\n      element.remove();\r\n    }\r\n\r\n    this.views = this.views.slice(0, start);\r\n\r\n    const components = await load;\r\n    // Create the new elements\r\n    const additions = components.slice(start)\r\n      .map(Component => new Component());\r\n\r\n    // Combine the newly created elements in order\r\n    // while being careful not to render them yet\r\n    for (let i = 0; i < additions.length - 1; i++) {\r\n      const parent = additions[i];\r\n      const child = additions[i + 1];\r\n      parent.append(child);\r\n    }\r\n\r\n    this.views = this.views.concat(additions);\r\n\r\n    // In correct order, resolve any new properties\r\n    // Note: this happens before the new elements are connected\r\n    const url = decodeURIComponent(location.pathname);\r\n    for (let i = 0; i < this.views.length; i++) {\r\n      const view = this.views[i];\r\n      const route = matched[i];\r\n      const Component = components[i];\r\n\r\n      const active = new ActivatedRoute(route, url);\r\n\r\n      const parameters = active.parameters;\r\n      const options = Component.properties;\r\n      if (options != null) {\r\n        // Resolve parameters from paths\r\n        for (const [key, value] of parameters) {\r\n          if (options.hasOwnProperty(key)) {\r\n            view[key] = value;\r\n          }\r\n        }\r\n\r\n        // Resolve additional properties from route\r\n        for (const key in route.properties) {\r\n          if (options.hasOwnProperty(key)) {\r\n            const value = route.properties[key];\r\n            view[key] = value;\r\n          }\r\n        }\r\n      }\r\n\r\n      view.route = active;\r\n\r\n      if (route.slot) {\r\n        view.setAttribute('slot', route.slot);\r\n      }\r\n    }\r\n\r\n    // If there are any additions, they need to be rendered\r\n    if (additions.length > 0) {\r\n      if (start > 0) {\r\n        // Some reuse\r\n        // Connect the new elements to the deepest reused element,\r\n        // implicitly rendering them\r\n        this.views[start - 1].append(additions[0]);\r\n      } else {\r\n        // No reuse\r\n        this.target.append(this.views[0]);\r\n      }\r\n    }\r\n  }\r\n\r\n  teardown() {\r\n    while (this.views.length > 0) {\r\n      const view = this.views.pop();\r\n      view.remove();\r\n    }\r\n  }\r\n}\r\n"],"names":["MATCH_ALL","CATCH_ALL","PARAMETER_PATTERN","MATCH_TRAILING_SLASH","WILDCARD_PATTERN","Path","[object Object]","path","exact","match","replace","keys","exec","push","endsWith","pattern","RegExp","this","test","matched","ParsedExpression","current","target","values","slice","transferred","i","length","url","key","indexOf","value","get","undefined","reduce","object","entries","Symbol","iterator","Query","Map","Object","pairs","string","startsWith","substring","split","map","normalize","isFunction","tag","toStringTag","isNormalFunction","hasOwnProperty","isArrowFunction","isPromise","clone","obj","assign","freeze","always","EMPTY","create","components","WeakMap","load","component","callback","customelements","has","called","then","m","ctor","default","set","Route","options","super","redirect","slot","guard","meta","properties","children","record","createChildRoute","Promise","resolve","Component","parent","ActivatedRoute","route","parameters","parse","query","hash","location","Router","records","views","routes","onPopstate","bind","window","connect","addEventListener","decodeURIComponent","pathname","history","replaceState","render","removeEventListener","teardown","data","title","pushState","search","find","r","matches","redirected","transfer","all","import","start","removals","pop","remove","additions","child","append","concat","view","active","setAttribute"],"mappings":"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"}