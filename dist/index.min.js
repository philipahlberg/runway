class t{constructor(){this.map=new Map}on(t,e){let s;this.map.has(t)?s=this.map.get(t):(s=new Set,this.map.set(t,s)),s.add(e)}off(t,e){if(!this.map.has(t))return;this.map.get(t).delete(e)}emit(t,e){if(!this.map.has(t))return;const s=this.map.get(t);for(const t of s)t(e)}}class e extends Map{static from(t){return new e(Object.entries(t))}static parse(t){/\?/.test(t)&&(t=t.replace(/^.*\?/,"")),/#/.test(t)&&(t=t.replace(/#.*$/,""));let s=[];return""!==t&&(s=t.split("&").map(t=>t.split("="))),new e(s)}toString(){return Array.from(this.entries()).map(t=>t.join("=")).join("&")}}const s=/\*\*/g,i=/:([^\/?#]+)/g,n=t=>{let e,s=[];for(;null!=(e=i.exec(t));)s.push(e[1]);return s},r=(t,e=!1)=>new RegExp("^"+t.replace(s,"[^/?#]*").replace(i,"([^/?#]+)")+"(?:[/]?(?=$))?"+(e?"(?:\\?.*)?(?:#.*)?$":""),"i"),h=(t,e)=>(t.exec(e)||[]).slice(1),o=(t,e)=>new Map(((t,e)=>t.map((t,s)=>[t,e[s]]))(t,e)),a=(t,e)=>t.reduce((t,s,i)=>(t[s]=e[i],t),{});class c{constructor(t,e=!1){this.keys=n(t),this.pattern=r(t,e)}matches(t){return this.pattern.test(t)}matched(t){const e=this.pattern.exec(t);return e&&e[0]||""}values(t){return h(this.pattern,t)}toMap(t){const e=this.values(t);return o(this.keys,e)}toObject(t){const e=this.values(t);return a(this.keys,e)}transfer(t,e){const s=this.values(t);let i=s.length;for(;i--;)e=e.replace(":"+this.keys[i],s[i]);return e}}function p(){return Object.create(null)}function l(){return!0}!function(t){Object.freeze(t)}(p());function u(t){return("/"+t).replace(/[\/]+/g,"/")}function d(t){return decodeURIComponent(t)}class m extends c{constructor(t){let{path:e,component:s,exact:i,redirect:n,slot:r,guard:h,properties:o,children:a}=t;null==i&&(i=null==a||0===a.length),super(e,i),this.path=e,this.exact=i,this.redirect=n,this.component="string"==typeof s?customElements.get(s):s,this.slot=r,this.guard=h||l,this.properties=o||p,this.children=(a||[]).map(t=>(function(t,e){""===t.path?t.path=e.path:t.path=u(e.path+"/"+t.path);null!=t.redirect&&(t.redirect=u(e.path+"/"+t.redirect));return new m(t)})(t,this))}async import(){const t=m.cache,e=this.component;if(s=e,HTMLElement.isPrototypeOf(s))return e;if(t.has(e))return t.get(e);{const s=(await this.component()).default;return t.set(e,s),s}var s}snapshot(t){const{pathname:s,search:i,hash:n}=t;return{parameters:this.toMap(d(s)),query:e.parse(d(i)),matched:this.matched(d(s)),hash:n.substring(1)}}}m.cache=new WeakMap;const g=history;class f extends t{constructor(){super(),this.onPopstate=this.onPopstate.bind(this)}connect(){window.addEventListener("popstate",this.onPopstate)}disconnect(){window.removeEventListener("popstate",this.onPopstate)}onPopstate(){const t=d(location.pathname);this.emit("pop",{path:t})}push(t,e={}){const{data:s,title:i}=e;g.pushState(s,i||document.title,t),this.emit("push",{path:t})}replace(t,e={}){const{data:s,title:i}=e;g.replaceState(s,i||document.title,t),this.emit("replace",{path:t})}pop(t=1){g.go(-t)}}class b extends t{constructor(t){super(),this.isConnected=!1,this.elements=[],this.activeRoutes=[],this.routes=t.map(t=>new m(t)),this.onPopstate=this.onPopstate.bind(this),this.history=new f,this.history.on("pop",this.onPopstate)}async connect(t){this.isConnected=!0,this.root=t;const e=d(location.pathname),{matched:s,path:i}=this.match(e);this.history.connect(),this.history.replace(i),await this.render(s),this.emit("connect")}disconnect(){this.isConnected=!1,this.activeRoutes=[],this.root=void 0,this.teardown(),this.history.disconnect(),this.emit("disconnect")}onPopstate(t){const{matched:e,path:s}=this.match(t);t!==s&&this.history.replace(s),this.emit("pop"),this.render(e)}async push(t,e){t=d(t);const{matched:s,path:i}=this.match(t);this.history.push(i,e),this.emit("push"),await this.render(s)}async replace(t,e){t=d(t);const{matched:s,path:i}=this.match(t);this.history.replace(i,e),this.emit("replace"),await this.render(s)}pop(t=1){this.history.pop(t)}search(t,e,s){const i=e.find(e=>e.matches(t)&&e.guard());if(i){if(s.push(i),i.redirect){const e=i.matched(t),s=i.redirect,n=i.transfer(e,s);return this.search(n,this.routes,[])}return i.children?this.search(t,i.children,s):{matched:s,path:t}}return{matched:s,path:t}}match(t){return this.search(t,this.routes,[])}async render(t){if(void 0==this.root)return;const e=Promise.all(t.map(t=>t.import()));let s;const i=this.activeRoutes,n=Math.min(t.length,i.length);for(s=0;s<n&&t[s]===i[s];s++);this.activeRoutes=t;const r=this.elements.slice(s);for(;r.length>0;){const t=r.pop();t&&t.parentElement&&t.parentElement.removeChild(t)}this.elements=this.elements.slice(0,s);const h=(await e).slice(s).map(t=>new t);this.elements=this.elements.concat(h);for(let t=s;t<this.elements.length;t++){const e=this.elements[t],s=this.activeRoutes[t];s.slot&&e.setAttribute("slot",s.slot)}for(let t=0;t<h.length-1;t++){const e=h[t],s=h[t+1];e.appendChild(s)}this.updateProperties(),h.length>0&&(s>0?this.elements[s-1].appendChild(h[0]):this.root.appendChild(this.elements[0])),this.emit("render")}updateProperties(){for(let t=0;t<this.elements.length;t++){const e=this.elements[t],s=customElements.get(e.tagName.toLowerCase()).properties,i=this.activeRoutes[t];if(void 0!=s){const t=i.snapshot(window.location),n=t.parameters;for(const[t,i]of n)s.hasOwnProperty(t)&&(e[t]=i);const r=i.properties(t),h=Object.keys(r);for(const t of h)s.hasOwnProperty(t)&&(e[t]=r[t])}}}teardown(){for(;this.elements.length>0;){const t=this.elements.pop();t&&t.parentElement&&t.parentElement.removeChild(t)}}}class v extends HTMLElement{constructor(){super(),this.onClick=this.onClick.bind(this),this.onChange=this.onChange.bind(this)}static define(t="router-link",e){this.tagName=t,this.router=e.router,customElements.define(t,this)}set to(t){this.setAttribute("to",t)}get to(){return this.getAttribute("to")}set exact(t){this.toggleAttribute("exact",t),this.active=this.test(d(location.pathname))}get exact(){return this.hasAttribute("exact")}set active(t){this.toggleAttribute("active",t)}get active(){return this.hasAttribute("active")}set disabled(t){this.toggleAttribute("disabled",t)}get disabled(){return this.hasAttribute("disabled")}get router(){return v.router}attributeChangedCallback(t,e,s){if(e!==s)if("disabled"===t){null!=s?(this.active=!1,this.router.off("render",this.onChange)):(this.router.on("render",this.onChange),this.onChange())}else if("to"===t){const t=this.querySelector("a");t&&(t.href=s),this.active=this.test(d(location.pathname))}}connectedCallback(){const t=this.querySelector("a");t&&(this.to?t.href=this.to:this.to=d(t.pathname)),this.addEventListener("click",this.onClick),this.router.on("render",this.onChange),this.onChange()}disconnectedCallback(){this.removeEventListener("click",this.onClick),this.router.off("render",this.onChange)}toggleAttribute(t,e){null!=e?e?this.setAttribute(t,""):this.removeAttribute(t):this.toggleAttribute(t,!this.hasAttribute(t))}test(t){const e=this.to;return e.startsWith("/")?this.exact?t===e:t.startsWith(e):t.endsWith(e)}onClick(t){t.metaKey||t.altKey||t.ctrlKey||t.shiftKey||t.defaultPrevented||void 0!==t.button&&0!==t.button||(t.preventDefault(),!this.disabled&&this.to&&this.router.push(this.to))}onChange(){this.active=this.test(d(location.pathname))}}v.observedAttributes=["disabled","to"],v.tagName="router-link";export default b;export{b as Router,v as RouterLink};
//# sourceMappingURL=index.min.js.map
