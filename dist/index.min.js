class t{constructor(){this.map=new Map}on(t,e){let s;this.map.has(t)?s=this.map.get(t):(s=new Set,this.map.set(t,s)),s.add(e)}off(t,e){if(!this.map.has(t))return;this.map.get(t).delete(e)}emit(t,e){if(!this.map.has(t))return;const s=this.map.get(t);for(const t of s)t(e)}}class e extends Map{static from(t){return new e(Object.entries(t))}static parse(t){/\?/.test(t)&&(t=t.replace(/^.*\?/,"")),/#/.test(t)&&(t=t.replace(/#.*$/,""));let s=[];return""!==t&&(s=t.split("&").map(t=>t.split("="))),new e(s)}toString(){return Array.from(this.entries()).map(t=>t.join("=")).join("&")}}const s=/\*\*/g,i=/:([^\/?#]+)/g,n=t=>{let e,s=[];for(;null!=(e=i.exec(t));)s.push(e[1]);return s},r=(t,e=!1)=>new RegExp("^"+t.replace(s,"[^/?#]*").replace(i,"([^/?#]+)")+"(?:[/]?(?=$))?"+(e?"(?:\\?.*)?(?:#.*)?$":""),"i"),h=(t,e)=>(t.exec(e)||[]).slice(1),o=(t,e)=>new Map(((t,e)=>t.map((t,s)=>[t,e[s]]))(t,e)),a=(t,e)=>t.reduce((t,s,i)=>(t[s]=e[i],t),{});class c{constructor(t,e=!1){this.keys=n(t),this.pattern=r(t,e)}matches(t){return this.pattern.test(t)}matched(t){const e=this.pattern.exec(t);return e&&e[0]||""}values(t){return h(this.pattern,t)}toMap(t){const e=this.values(t);return o(this.keys,e)}toObject(t){const e=this.values(t);return a(this.keys,e)}transfer(t,e){const s=this.values(t);let i=s.length;for(;i--;)e=e.replace(":"+this.keys[i],s[i]);return e}}function l(){return Object.create(null)}function p(){return!0}!function(t){Object.freeze(t)}(l());function u(t){return("/"+t).replace(/[\/]+/g,"/")}function d(t){return decodeURIComponent(t)}const m=function(t){return Object.freeze(t)}(Object.create(null));class f extends c{constructor(t){let{path:e,component:s,exact:i,redirect:n,slot:r,guard:h,properties:o,children:a}=t;null==i&&(i=null==a||0===a.length),super(e,i),this.path=e,this.exact=i,this.redirect=n,this.component="string"==typeof s?customElements.get(s):s,this.slot=r,this.guard=h||p,this.properties=o||l,this.children=(a||[]).map(t=>(function(t,e){""===t.path?t.path=e.path:t.path=u(e.path+"/"+t.path);null!=t.redirect&&(t.redirect=u(e.path+"/"+t.redirect));return new f(t)})(t,this))}static async import(t){if("function"!=typeof t)throw new TypeError("Component must be a class or function.");if(HTMLElement.isPrototypeOf(t))return t;{const e=t(),s=await Promise.resolve(e);return s.default?s.default:s}}async import(){const t=f.cache,e=this.component;if(HTMLElement.isPrototypeOf(e))return e;if(t.has(e))return t.get(e);{const s=await f.import(e);return t.set(e,s),s}}snapshot(t){const{pathname:s,search:i,hash:n}=t;return{parameters:this.toMap(d(s)),query:e.parse(d(i)),matched:this.matched(d(s)),hash:n.substring(1)}}}f.cache=new WeakMap;const g=history;class b{constructor(t){this.onPopstate=t,this.onpop=this.onpop.bind(this)}connect(){window.addEventListener("popstate",this.onpop)}disconnect(){window.removeEventListener("popstate",this.onpop)}onpop(){const t=d(location.pathname);this.onPopstate(t)}push(t,e=m){const{data:s,title:i}=e;g.pushState(s,i,t)}replace(t,e=m){const{data:s,title:i}=e;g.replaceState(s,i,t)}go(t){g.go(t)}}class y extends t{constructor(t){super(),this.isConnected=!1,this.elements=[],this.matched=[],this.routes=t.map(t=>new f(t)),this.onpop=this.onpop.bind(this),this.history=new b(this.onpop),y.instance=this}async connect(t){this.isConnected=!0,this.root=t;const e=d(location.pathname),{matched:s,path:i}=this.match(e);this.history.connect(),this.history.replace(i),await this.render(s),this.emit("connect")}disconnect(){this.isConnected=!1,this.matched=[],this.root=void 0,this.teardown(),this.history.disconnect(),this.emit("disconnect")}onpop(t){const{matched:e,path:s}=this.match(t);t!==s&&this.history.replace(s),this.emit("pop"),this.render(e)}push(t,e){t=d(t);const{matched:s,path:i}=this.match(t);return this.history.push(i,e),this.emit("push"),this.render(s)}replace(t,e){t=d(t);const{matched:s,path:i}=this.match(t);return this.history.replace(i,e),this.emit("replace"),this.render(s)}go(t){this.history.go(t)}search(t,e,s){const i=e.find(e=>e.matches(t)&&e.guard());if(i){if(s.push(i),i.redirect){const e=i.matched(t),s=i.redirect,n=i.transfer(e,s);return this.search(n,this.routes,[])}return i.children?this.search(t,i.children,s):{matched:s,path:t}}return{matched:s,path:t}}match(t){return this.search(t,this.routes,[])}async render(t){if(void 0==this.root)return;const e=Promise.all(t.map(t=>t.import()));let s;for(let e=0;e<t.length;e++){const i=t[e];if(this.matched.length<e+1){s=e;break}if(i!==this.matched[e]){s=e;break}}null==s&&(s=t.length),this.matched=t;const i=this.elements.slice(s);for(;i.length>0;){const t=i.pop();t&&t.parentElement&&t.parentElement.removeChild(t)}this.elements=this.elements.slice(0,s);const n=(await e).slice(s).map(t=>new t);this.elements=this.elements.concat(n);for(let t=s;t<this.elements.length;t++){const e=this.elements[t],s=this.matched[t];s.slot&&e.setAttribute("slot",s.slot)}for(let t=0;t<n.length-1;t++){const e=n[t],s=n[t+1];e.appendChild(s)}this.updateProperties(),n.length>0&&(s>0?this.elements[s-1].appendChild(n[0]):this.root.appendChild(this.elements[0])),this.emit("render")}updateProperties(){for(let t=0;t<this.elements.length;t++){const e=this.elements[t],s=customElements.get(e.tagName.toLowerCase()).properties,i=this.matched[t];if(void 0!=s){const t=i.snapshot(window.location),n=t.parameters;for(const[t,i]of n)s.hasOwnProperty(t)&&(e[t]=i);const r=i.properties(t);for(const t in r)if(s.hasOwnProperty(t)){const s=r[t];e[t]=s}}}}teardown(){for(;this.elements.length>0;){const t=this.elements.pop();t&&t.parentElement&&t.parentElement.removeChild(t)}}}class v extends HTMLElement{constructor(){super(),this.router=y.instance,this.onClick=this.onClick.bind(this),this.onChange=this.onChange.bind(this)}static install(){customElements.define(this.tagName,this)}set to(t){this.setAttribute("to",t)}get to(){return this.getAttribute("to")}set exact(t){this.toggleAttribute("exact",t),this.active=this.test(d(location.pathname))}get exact(){return this.hasAttribute("exact")}set active(t){this.toggleAttribute("active",t)}get active(){return this.hasAttribute("active")}set disabled(t){this.toggleAttribute("disabled",t)}get disabled(){return this.hasAttribute("disabled")}attributeChangedCallback(t,e,s){if(e!==s)if("disabled"===t){null!=s?(this.active=!1,this.router.off("render",this.onChange)):(this.router.on("render",this.onChange),this.onChange())}else if("to"===t){const t=this.querySelector("a");t&&(t.href=s),this.active=this.test(d(location.pathname))}}connectedCallback(){const t=this.querySelector("a");t&&(this.to?t.href=this.to:this.to=d(t.pathname)),this.addEventListener("click",this.onClick),this.router.on("render",this.onChange),this.onChange()}disconnectedCallback(){this.removeEventListener("click",this.onClick),this.router.off("render",this.onChange)}toggleAttribute(t,e){null!=e?e?this.setAttribute(t,""):this.removeAttribute(t):this.toggleAttribute(t,!this.hasAttribute(t))}test(t){const e=this.to;return e.startsWith("/")?this.exact?t===e:t.startsWith(e):t.endsWith(e)}onClick(t){t.metaKey||t.altKey||t.ctrlKey||t.shiftKey||t.defaultPrevented||void 0!==t.button&&0!==t.button||(t.preventDefault(),!this.disabled&&this.to&&this.router.push(this.to))}onChange(){this.active=this.test(d(location.pathname))}}v.observedAttributes=["disabled","to"],v.tagName="router-link";export default y;export{y as Router,v as RouterLink};
//# sourceMappingURL=index.min.js.map
