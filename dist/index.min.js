class EventEmitter{constructor(){this.map=new Map}on(t,e){let s;this.map.has(t)?s=this.map.get(t):(s=new Set,this.map.set(t,s)),s.add(e)}off(t,e){if(!this.map.has(t))return;this.map.get(t).delete(e)}emit(t,e){if(!this.map.has(t))return;const s=this.map.get(t);for(const t of s)t(e)}}function normalize(t){return("/"+t).replace(/[\/]+/g,"/")}function decode(t){return decodeURIComponent(t)}function split(t){let e=t.split("#");const s=e[1]||"",n=(e=(e[0]||"").split("?"))[1]||"";return{pathname:e[0]||"",search:n,hash:s}}function pathname(t){return(t.split("#")[0]||"").split("?")[0]}function search(t){return t=t.split("#")[0]||"",/\?/.test(t)?t.split("?")[1]||"":t}function isFunction(t){if("function"!=typeof t)return!1;const e=t[Symbol.toStringTag];if("AsyncFunction"===e||"GeneratorFunction"===e)return!0;{const e=t.hasOwnProperty("arguments"),s=!t.hasOwnProperty("prototype");return e||s}}function isModule(t){return"Module"===t[Symbol.toStringTag]||t.__esModule}function freeze(t){return Object.freeze(t)}function empty(){return Object.create(null)}function always(){return!0}function zip(t,e){return t.map((t,s)=>[t,e[s]])}function dictionary(t){let e=-1;const s=t.length,n={};for(;++e<s;){const s=t[e];n[s[0]]=s[1]}return n}const EMPTY=freeze(Object.create(null)),MATCH_ALL="[^/]*",CATCH_ALL="([^/]+)",PARAMETER_PATTERN=/:([^\/]+)/,MATCH_TRAILING_SLASH="(?:[/]?(?=$))?",WILDCARD_PATTERN=/\*\*/g;class Path{constructor(t="",e=!1){t=pathname(t),this.path=t,this.exact=e;let s,n=t.replace(WILDCARD_PATTERN,MATCH_ALL),i=[];for(;null!=(s=PARAMETER_PATTERN.exec(n));)n=n.replace(s[0],CATCH_ALL),i.push(s[1]);n.endsWith("/")||(n+=MATCH_TRAILING_SLASH),n=e?`^${n}$`:`^${n}`;const r=new RegExp(n,"i");this.keys=i,this.pattern=r}matches(t){return this.pattern.test(pathname(t))}matched(t){let e=this.pattern.exec(pathname(t));return e&&e[0]||""}parse(t){return new Parameters(t,this.pattern,this.keys)}transfer(t,e){const s=(this.pattern.exec(t)||[]).slice(1);let n=e,i=s.length;for(;i--;)n=n.replace(":"+this.keys[i],s[i]);return n}}class Parameters extends Map{constructor(t,e,s){t=pathname(t),super(zip(s,(e.exec(t)||[]).slice(1))),this.path=t}all(){return dictionary(Array.from(this.entries()))}}class Query extends Map{static from(t){return new Query(Object.entries(t))}static parse(t){const e=search(t);let s=[];return""!==e&&(s=e.split("&").map(t=>t.split("="))),new Query(s)}all(){return dictionary(Array.from(this.entries()))}toString(){let t="";for(const[e,s]of this)t+=`&${e}=${s}`;return t.substring(1)}}class Route extends Path{constructor(t){let{path:e,component:s,exact:n,redirect:i,slot:r,guard:o,properties:h,children:a}=t;null==n&&(n=null==a||0===a.length),super(e,n),this.path=e,this.exact=n,this.redirect=i,this.component=s,this.slot=r,this.guard=o||always,this.properties=h||empty,this.children=(a||[]).map(t=>createChildRoute(t,this)),freeze(this)}static async import(t){if("string"==typeof t)return customElements.get(t);if(isFunction(t)){let e=t(),s=await Promise.resolve(e);return isModule(s)?s.default:s}return t}async import(){if(Route.cache.has(this.component))return Route.cache.get(this.component);{let t=await Route.import(this.component);return Route.cache.set(this.component,t),t}}snapshot(t){let e;return e="string"==typeof t?split(t):t,freeze({parameters:this.parse(decode(e.pathname)),query:Query.parse(decode(e.search)),matched:this.matched(decode(e.pathname)),hash:e.hash})}}function createChildRoute(t,e){return t.path=normalize(e.path+"/"+t.path),null!=t.redirect&&(t.redirect=normalize(e.path+"/"+t.redirect)),new Route(t)}Route.cache=new Map;const h=history,onpop=Symbol("onpop");class History{constructor(t){this.onPopstate=t,this[onpop]=this[onpop].bind(this)}connect(){window.addEventListener("popstate",this[onpop])}disconnect(){window.removeEventListener("popstate",this[onpop])}[onpop](){const t=decode(location.pathname);this.onPopstate(t)}push(t,e=EMPTY){const{data:s,title:n}=e;h.pushState(s,n,t)}replace(t,e=EMPTY){const{data:s,title:n}=e;h.replaceState(s,n,t)}go(t){h.go(t)}}class Router extends EventEmitter{constructor(t){super(),this.isConnected=!1,this.elements=[],this.matched=[],this.routes=t.map(t=>new Route(t)),this.onpop=this.onpop.bind(this),this.history=new History(this.onpop),Router.instance=this}async connect(t){this.isConnected=!0,this.root=t;const e=decode(location.pathname),{matched:s,path:n}=this.match(e);this.history.connect(),this.history.replace(n),await this.render(s),this.emit("connect")}disconnect(){this.isConnected=!1,this.matched=[],this.root=void 0,this.teardown(),this.history.disconnect(),this.emit("disconnect")}onpop(t){const{matched:e,path:s}=this.match(t);t!==s&&this.history.replace(s),this.emit("pop"),this.render(e)}push(t,e){t=decode(t);const{matched:s,path:n}=this.match(t);return this.history.push(n,e),this.emit("push"),this.render(s)}replace(t,e){t=decode(t);const{matched:s,path:n}=this.match(t);return this.history.replace(n,e),this.emit("replace"),this.render(s)}go(t){this.history.go(t)}search(t,e,s){const n=e.find(e=>e.matches(t)&&e.guard());if(n){if(s.push(n),n.redirect){const e=n.matched(pathname(t)),s=n.redirect,i=n.transfer(e,s);return this.search(i,this.routes,[])}return n.children?this.search(t,n.children,s):{matched:s,path:t}}return{matched:s,path:t}}match(t){return this.search(t,this.routes,[])}async render(t){if(void 0==this.root)return;const e=Promise.all(t.map(t=>t.import()));let s;for(let e=0;e<t.length;e++){const n=t[e];if(this.matched.length<e+1){s=e;break}if(n!==this.matched[e]){s=e;break}}null==s&&(s=t.length),this.matched=t;const n=this.elements.slice(s);for(;n.length>0;){n.pop().remove()}this.elements=this.elements.slice(0,s);const i=(await e).slice(s).map(t=>new t);this.elements=this.elements.concat(i);for(let t=s;t<this.elements.length;t++){const e=this.elements[t],s=this.matched[t];s.slot&&e.setAttribute("slot",s.slot)}for(let t=0;t<i.length-1;t++){const e=i[t],s=i[t+1];e.appendChild(s)}this.updateProperties(),i.length>0&&(s>0?this.elements[s-1].appendChild(i[0]):this.root.appendChild(this.elements[0])),this.emit("render")}updateProperties(){for(let t=0;t<this.elements.length;t++){const e=this.elements[t],s=customElements.get(e.tagName.toLowerCase()).properties,n=this.matched[t];if(void 0!=s){const t=n.snapshot(window.location),i=t.parameters;for(const[t,n]of i)s.hasOwnProperty(t)&&(e[t]=n);const r=n.properties(t);for(const t in r)if(s.hasOwnProperty(t)){const s=r[t];e[t]=s}}}}teardown(){for(;this.elements.length>0;){this.elements.pop().remove()}}}class RouterLink extends HTMLElement{constructor(){super(),this.router=Router.instance,this.onClick=this.onClick.bind(this),this.onChange=this.onChange.bind(this)}static install(){customElements.define(this.tagName,this)}get anchor(){return this.querySelector("a")}set to(t){this.anchor.href=t;const e=decodeURIComponent(location.pathname);this.active=this.match(e)}get to(){return decodeURIComponent(this.anchor.pathname)}set exact(t){this.toggleAttribute("exact",t);const e=decodeURIComponent(location.pathname);this.active=this.match(e)}get exact(){return this.hasAttribute("exact")}set active(t){this.toggleAttribute("active",t)}get active(){return this.hasAttribute("active")}set disabled(t){this.toggleAttribute("disabled",t)}get disabled(){return this.hasAttribute("disabled")}attributesChangedCallback(t,e,s){if(e!==s&&"disabled"===t){null!=s?(this.active=!1,this.router.off("render",this.onChange)):(this.router.on("render",this.onChange),this.onChange())}}connectedCallback(){this.addEventListener("click",this.onClick),this.router.on("render",this.onChange),this.onChange()}disconnectedCallback(){this.removeEventListener("click",this.onClick),this.router.off("render",this.onChange)}toggleAttribute(t,e){e?this.setAttribute(t,""):this.removeAttribute(t)}match(t){const e=this.to;return e.startsWith("/")?this.exact?t===e:t.startsWith(e):t.endsWith(e)}onClick(t){if(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)return;if(t.defaultPrevented)return;if(void 0!==t.button&&0!==t.button)return;t.preventDefault();const e=this.to;!this.disabled&&e&&this.router.push(e)}onChange(){const t=decodeURIComponent(location.pathname);this.active=this.match(t)}}RouterLink.observedAttributes=["disabled"],RouterLink.tagName="router-link";export default Router;export{Path,Query,Route,RouterLink};
//# sourceMappingURL=index.min.js.map
